-- 1. Airports Table
CREATE TABLE Airports (
    airport_code CHAR(3) PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    city VARCHAR(50) NOT NULL,
    country VARCHAR(50) NOT NULL,
    timezone_offset DECIMAL(2, 0) -- e.g., 5 for UTC+5
);

--------------------------------------------------

-- 2. Airlines Table
CREATE TABLE Airlines (
    airline_id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(100) NOT NULL UNIQUE,
    iata_code CHAR(2) NOT NULL UNIQUE,
    contact_number VARCHAR(20)
);

--------------------------------------------------

-- 3. Aircrafts Table
CREATE TABLE Aircrafts (
    aircraft_id INT PRIMARY KEY AUTO_INCREMENT,
    model VARCHAR(50) NOT NULL,
    capacity INT NOT NULL,
    airline_id INT,
    FOREIGN KEY (airline_id) REFERENCES Airlines(airline_id)
);

--------------------------------------------------

-- 4. Flights Table
CREATE TABLE Flights (
    flight_number VARCHAR(10) PRIMARY KEY,
    departure_airport_code CHAR(3) NOT NULL,
    arrival_airport_code CHAR(3) NOT NULL,
    airline_id INT NOT NULL,
    aircraft_id INT NOT NULL,
    departure_time DATETIME NOT NULL,
    arrival_time DATETIME NOT NULL,
    price DECIMAL(10, 2) NOT NULL,
    
    FOREIGN KEY (departure_airport_code) REFERENCES Airports(airport_code),
    FOREIGN KEY (arrival_airport_code) REFERENCES Airports(airport_code),
    FOREIGN KEY (airline_id) REFERENCES Airlines(airline_id),
    FOREIGN KEY (aircraft_id) REFERENCES Aircrafts(aircraft_id),

    -- Constraint to prevent flights to and from the same airport
    CHECK (departure_airport_code <> arrival_airport_code)
);

--------------------------------------------------

-- 5. Passengers Table
CREATE TABLE Passengers (
    passenger_id INT PRIMARY KEY AUTO_INCREMENT,
    first_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50) NOT NULL,
    date_of_birth DATE,
    nationality VARCHAR(50),
    email VARCHAR(100) UNIQUE
);

--------------------------------------------------

-- 6. Bookings Table (Junction Table for Flights and Passengers)
CREATE TABLE Bookings (
    booking_id INT PRIMARY KEY AUTO_INCREMENT,
    flight_number VARCHAR(10) NOT NULL,
    passenger_id INT NOT NULL,
    booking_date DATETIME DEFAULT CURRENT_TIMESTAMP,
    seat_number VARCHAR(5),
    class_type ENUM('Economy', 'Business', 'First') NOT NULL,

    FOREIGN KEY (flight_number) REFERENCES Flights(flight_number),
    FOREIGN KEY (passenger_id) REFERENCES Passengers(passenger_id),

    -- Ensure a passenger can only be booked once per flight
    UNIQUE (flight_number, passenger_id)
);

INSERT INTO Airports (airport_code, name, city, country, timezone_offset) VALUES
('EBB', 'Entebbe Intl. Airport', 'Kampala', 'UGANDA', +3),
('KGL', 'Kigali Intl. Airport', 'Kigali', 'RWANDA', +2),
('DXB', 'Dubai Intl.', 'Dubai', 'UAE', 4);
('Emirates', 'EK', '+971 600 555 555'),        -- airline_id = 1
('flydubai', 'FZ', '+971 600 544 400'),        -- airline_id = 2
('Uganda Airlines', 'UR', '+256 200 406 400'), -- airline_id = 3
('RwandAir', 'WB', '+250 788 177 000'),        -- airline_id = 4
('Kenya Airways', 'KQ', '+254 711 021 000'),   -- airline_id = 5
('Qatar Airways', 'QR', '+974 4022 6000');     -- airline_id = 6

-- Airlines operating at Kigali (KGL)
('RwandAir', 'WB', '+250 788 177 000'), -- Rwanda's national carrier and KGL hub
('Kenya Airways', 'KQ', '+254 711 021 000'), -- Major regional connection to KGL
('Qatar Airways', 'QR', '+974 4022 6000'); -- Major international connection to KGL
;

--------------------------------------------------

INSERT INTO Aircrafts (airline_id, model, capacity) VALUES
-- Emirates (airline_id 1)
(1, 'Boeing 777-300ER', 360),
(1, 'Airbus A380-800', 484),

-- flydubai (airline_id 2)
(2, 'Boeing 737 MAX 8', 170),

-- Uganda Airlines (airline_id 3)
(3, 'Airbus A330-800neo', 260),
(3, 'Bombardier CRJ-900', 76),

-- RwandAir (airline_id 4)
(4, 'Airbus A330-300', 274),
(4, 'Boeing 737-800', 154),

-- Kenya Airways (airline_id 5)
(5, 'Boeing 787-8 Dreamliner', 234),

-- Qatar Airways (airline_id 6)
(6, 'Boeing 787-9 Dreamliner', 311);

--------------------------------------------------

-- Insert into Flights
INSERT INTO Flights (flight_number, departure_airport_code, arrival_airport_code, airline_id, aircraft_id, departure_time, arrival_time, price) VALUES
-- DUBAI (DXB) <> ENTEBBE (EBB)
-- EK 730: DXB to EBB (Emirates, B777-300ER, ID 1)
('EK 730', 'DXB', 'EBB', 1, 1, '2025-11-20 09:00:00', '2025-11-20 13:30:00', 650.00), 
-- UR 440: EBB to DXB (Uganda Airlines, A330-800neo, ID 4)
('UR 440', 'EBB', 'DXB', 3, 4, '2025-11-20 16:00:00', '2025-11-20 22:30:00', 580.00), 
-- FZ 637: DXB to EBB (flydubai, B737 MAX 8, ID 3)
('FZ 637', 'DXB', 'EBB', 2, 3, '2025-11-21 00:30:00', '2025-11-21 05:00:00', 350.00),

-- KIGALI (KGL) <> DUBAI (DXB)
-- WB 302: KGL to DXB (RwandAir, A330-300, ID 6)
('WB 302', 'KGL', 'DXB', 4, 6, '2025-11-22 08:30:00', '2025-11-22 15:50:00', 520.00), 
-- QR 1387: DXB to KGL (Qatar Airways, B787-9, ID 9 - one-stop via DOH is common)
('QR 1387', 'DXB', 'KGL', 6, 9, '2025-11-22 18:00:00', '2025-11-23 00:45:00', 680.00), 

-- KIGALI (KGL) <> ENTEBBE (EBB) - Regional Flights
-- UR 202: EBB to KGL (Uganda Airlines, CRJ-900, ID 5)
('UR 202', 'EBB', 'KGL', 3, 5, '2025-11-23 07:00:00', '2025-11-23 08:00:00', 120.00),
-- KQ 402: KGL to EBB (Kenya Airways, B787-8, ID 8 - a widebody on this route for a short time)
('KQ 402', 'KGL', 'EBB', 5, 8, '2025-11-23 11:30:00', '2025-11-23 12:30:00', 145.00),
-- WB 400: KGL to EBB (RwandAir, B737-800, ID 7)
('WB 400', 'KGL', 'EBB', 4, 7, '2025-11-24 18:00:00', '2025-11-24 19:00:00', 130.00);

--------------------------------------------------

-- Insert into Passengers
INSERT INTO Passengers (first_name, last_name, date_of_birth, nationality, email) VALUES

('Ahmed', 'Al Marzooqi', '1985-05-15', 'UAE', 'ahmed.almarzooqi@mail.com'),    
('Grace', 'Nassuna', '1992-10-21', 'Ugandan', 'grace.nassuna@email.com'),    
('Jean-Claude', 'Munyaneza', '1978-01-03', 'Rwandan', 'jeanclaude.m@kgl.net'),  
('Sarah', 'Ochieng', '2001-07-28', 'Kenyan', 'sarah.ochieng@webmail.org'),       
('David', 'Patel', '1965-03-10', 'British', 'david.patel@global.co');           

--------------------------------------------------


INSERT INTO Bookings (flight_number, passenger_id, booking_date, seat_number, class_type) VALUES
-- Ahmed Al Marzooqi (ID 1) flies Emirates DXB to EBB
('EK 730', 1, '2025-10-01 10:00:00', '3K', 'Business'),
-- Grace Nassuna (ID 2) flies Uganda Airlines EBB to DXB
('UR 440', 2, '2025-10-05 15:30:00', '21A', 'Economy'),
-- Jean-Claude Munyaneza (ID 3) flies RwandAir KGL to DXB (First Class)
('WB 302', 3, '2025-10-10 09:00:00', '1A', 'First'),
-- Sarah Ochieng (ID 4) flies a regional flight EBB to KGL
('UR 202', 4, '2025-10-15 11:20:00', '10C', 'Economy'),
-- David Patel (ID 5) flies flydubai DXB to EBB
('FZ 637', 5, '2025-10-20 18:00:00', '5A', 'Business'),
-- Grace Nassuna (ID 2) also flies the regional KGL to EBB (same passenger, different flight)
('KQ 402', 2, '2025-10-22 14:00:00', '2K', 'Business');

SELECT 
    p.first_name, 
    p.last_name, 
    b.seat_number, 
    b.class_type
FROM 
    Passengers p
JOIN 
    Bookings b ON p.passenger_id = b.passenger_id
WHERE 
    b.flight_number = 'GA101';
SELECT 
    f.flight_number, 
    a.name AS airline_name, 
    f.departure_time, 
    f.price
FROM 
    Flights f
JOIN 
    Airlines a ON f.airline_id = a.airline_id
WHERE 
    f.departure_airport_code = 'JFK';-
