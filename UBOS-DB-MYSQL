-- 1. Create the database
CREATE DATABASE ubos_census_db;
USE ubos_census_db;

-- 2. Create Geographical Hierarchy Tables (DISTRICT, SUBCOUNTY, PARISH)

CREATE TABLE DISTRICT (
    District_ID INT PRIMARY KEY,
    District_Name VARCHAR(100) NOT NULL UNIQUE
);

CREATE TABLE SUBCOUNTY (
    SubCounty_ID INT PRIMARY KEY,
    SubCounty_Name VARCHAR(100) NOT NULL,
    District_ID INT NOT NULL,
    FOREIGN KEY (District_ID) REFERENCES DISTRICT(District_ID)
);

CREATE TABLE PARISH (
    Parish_ID INT PRIMARY KEY,
    Parish_Name VARCHAR(100) NOT NULL,
    SubCounty_ID INT NOT NULL,
    FOREIGN KEY (SubCounty_ID) REFERENCES SUBCOUNTY(SubCounty_ID)
);

-- 3. Create HOMESTEAD Table (Linked to PARISH)

CREATE TABLE HOMESTEAD (
    Homestead_ID INT PRIMARY KEY,
    Residence_Address VARCHAR(255),
    Parish_ID INT NOT NULL,
    FOREIGN KEY (Parish_ID) REFERENCES PARISH(Parish_ID)
);

-- 4. Create EMPLOYER Table

CREATE TABLE EMPLOYER (
    Employer_ID INT PRIMARY KEY,
    Employer_Name VARCHAR(255) NOT NULL UNIQUE,
    Industry_Type VARCHAR(100)
);

-- 5. Create CITIZEN Table (Core Entity)

CREATE TABLE CITIZEN (
    Citizen_ID INT PRIMARY KEY,
    Name VARCHAR(255) NOT NULL,
    Date_of_Birth DATE,
    Employment_Status ENUM('Employed', 'Unemployed', 'Self-Employed', 'Student', 'Retired') NOT NULL,
    
    -- Foreign Keys
    Homestead_ID INT NOT NULL,
    Employer_ID INT, -- NULL is allowed for unemployed or self-employed
    
    FOREIGN KEY (Homestead_ID) REFERENCES HOMESTEAD(Homestead_ID),
    FOREIGN KEY (Employer_ID) REFERENCES EMPLOYER(Employer_ID)
);

-- 6. Create DEPENDENT Table (One-to-Many with CITIZEN)

CREATE TABLE DEPENDENT (
    Dependent_ID INT PRIMARY KEY,
    Dependent_Name VARCHAR(255) NOT NULL,
    Citizen_ID INT NOT NULL, -- The citizen supporting this dependent
    
    FOREIGN KEY (Citizen_ID) REFERENCES CITIZEN(Citizen_ID)
);

-- 7. Create INCOME_SOURCE and junction table CITIZEN_INCOME (Many-to-Many)

CREATE TABLE INCOME_SOURCE (
    Source_ID INT PRIMARY KEY,
    Source_Description VARCHAR(100) NOT NULL UNIQUE
);

CREATE TABLE CITIZEN_INCOME (
    Citizen_ID INT NOT NULL,
    Source_ID INT NOT NULL,
    Amount DECIMAL(15, 2) NOT NULL,
    
    PRIMARY KEY (Citizen_ID, Source_ID), -- Composite Primary Key
    FOREIGN KEY (Citizen_ID) REFERENCES CITIZEN(Citizen_ID),
    FOREIGN KEY (Source_ID) REFERENCES INCOME_SOURCE(Source_ID)
);

-- 8. Create EDUCATION_LEVEL and junction table CITIZEN_EDUCATION (Many-to-Many)

CREATE TABLE EDUCATION_LEVEL (
    Edu_ID INT PRIMARY KEY,
    Level_Name VARCHAR(100) NOT NULL UNIQUE
);

CREATE TABLE CITIZEN_EDUCATION (
    Citizen_ID INT NOT NULL,
    Edu_ID INT NOT NULL,
    Year_Completed YEAR,
    
    PRIMARY KEY (Citizen_ID, Edu_ID), -- Composite Primary Key
    FOREIGN KEY (Citizen_ID) REFERENCES CITIZEN(Citizen_ID),
    FOREIGN KEY (Edu_ID) REFERENCES EDUCATION_LEVEL(Edu_ID)
);

USE ubos_census_db;

-- 1. Insert data into DISTRICT
INSERT INTO DISTRICT (District_ID, District_Name) VALUES
(10, 'Kampala'),
(20, 'Mukono');

-- 2. Insert data into SUBCOUNTY
INSERT INTO SUBCOUNTY (SubCounty_ID, SubCounty_Name, District_ID) VALUES
(101, 'Central Division', 10),
(201, 'Ggaba Division', 10),
(301, 'Central Mukono', 20);

-- 3. Insert data into PARISH
INSERT INTO PARISH (Parish_ID, Parish_Name, SubCounty_ID) VALUES
(1001, 'Nakasero I', 101),
(1002, 'Kisenyi II', 201),
(2001, 'Kiwanga', 301);

-- 4. Insert data into HOMESTEAD
INSERT INTO HOMESTEAD (Homestead_ID, Residence_Address, Parish_ID) VALUES
(1, 'Plot 14 Acacia Ave', 1001), -- Kampala, Nakasero I
(2, 'House 34 Kisenyi Rd', 1002), -- Kampala, Kisenyi II
(3, 'Block 7 Kyaggwe', 2001);  -- Mukono, Kiwanga

-- 5. Insert data into EMPLOYER
INSERT INTO EMPLOYER (Employer_ID, Employer_Name, Industry_Type) VALUES
(501, 'Uganda Telecom Ltd', 'Telecommunications'),
(502, 'Makerere University', 'Education'),
(503, 'Self-Employed (Trading)', 'Retail');

-- 6. Insert data into CITIZEN
INSERT INTO CITIZEN (Citizen_ID, Name, Date_of_Birth, Employment_Status, Homestead_ID, Employer_ID) VALUES
-- Employed, living in Homestead 1
(10001, 'Alex Ssekiboobo', '1985-05-15', 'Employed', 1, 501),
-- Employed, living in Homestead 1
(10002, 'Sarah Nantale', '1990-10-20', 'Employed', 1, 502),
-- Unemployed, living in Homestead 2
(10003, 'David Kabanda', '1970-01-01', 'Unemployed', 2, NULL),
-- Self-Employed, living in Homestead 3 (Employer ID is 503 for tracking purposes)
(10004, 'Miriam Nabisere', '1995-03-25', 'Self-Employed', 3, 503);

-- 7. Insert data into DEPENDENT
INSERT INTO DEPENDENT (Dependent_ID, Dependent_Name, Citizen_ID) VALUES
(1, 'Ben Ssekiboobo (Son)', 10001),
(2, 'Faith Nantale (Daughter)', 10002);

-- 8. Insert data into INCOME_SOURCE
INSERT INTO INCOME_SOURCE (Source_ID, Source_Description) VALUES
(1, 'Salary/Wages'),
(2, 'Rental Income'),
(3, 'Business Profits'),
(4, 'Remittance/Support');

-- 9. Insert data into CITIZEN_INCOME (Many-to-Many)
INSERT INTO CITIZEN_INCOME (Citizen_ID, Source_ID, Amount) VALUES
(10001, 1, 3500000.00), -- Alex: Salary
(10001, 2, 800000.00), -- Alex: Rental
(10002, 1, 2000000.00), -- Sarah: Salary
(10004, 3, 1500000.00), -- Miriam: Business Profits
(10003, 4, 300000.00);  -- David: Support

-- 10. Insert data into EDUCATION_LEVEL
INSERT INTO EDUCATION_LEVEL (Edu_ID, Level_Name) VALUES
(10, 'Primary School'),
(20, 'O-Level (Secondary)'),
(30, 'A-Level (High School)'),
(40, 'University Degree'),
(50, 'Post-Graduate');

-- 11. Insert data into CITIZEN_EDUCATION (Many-to-Many)
INSERT INTO CITIZEN_EDUCATION (Citizen_ID, Edu_ID, Year_Completed) VALUES
-- Alex's education
(10001, 20, 2002),
(10001, 40, 2007),
-- Sarah's education
(10002, 30, 2008),
(10002, 40, 2012),
-- David's education
(10003, 10, 1985);
